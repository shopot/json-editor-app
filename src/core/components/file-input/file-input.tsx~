import { type JSX, type InputHTMLAttributes, useRef } from 'react';

import { Button } from '../button';
import { StyledContainer, StyledInput, StyledSpinner, StyledSpinnerWrapper } from './styles';

export type FileInputProps = {
  label?: string;
  loading?: boolean;
} & InputHTMLAttributes<HTMLInputElement>;

export const FileInput = ({ label, loading = false, ...props }: FileInputProps): JSX.Element => {
  const fileInputRef = useRef<HTMLInputElement | null>(null);

  const handleClick = () => fileInputRef.current?.click();

  return (
    <StyledContainer>
      <StyledInput type="file" ref={fileInputRef} {...props} />
      <Button onClick={handleClick}>
        {loading && (
          <StyledSpinnerWrapper>
            <StyledSpinner /> Loading...
          </StyledSpinnerWrapper>
        )}
        {!loading && (label || 'Upload file')}
      </Button>
    </StyledContainer>
  );
};
